// ────────────── Input Configuration ──────────────
// https://github.com/YaLTeR/niri/wiki/Configuration:-Input

input {
    keyboard {
        xkb {
            layout "br"
        }
        repeat-delay 600
        repeat-rate 20
        numlock
    }

    mouse {
        accel-profile "flat"
    }

    focus-follows-mouse
}

// ────────────── Keybindings ──────────────
// https://github.com/YaLTeR/niri/wiki/Configuration:-Key-Bindings

binds {
    // ─── Applications ───
    MOD+Return    { spawn-sh "alacritty"; }
    MOD+Space     { spawn-sh "wofi"; }
    MOD+B         { spawn-sh "firefox"; }
    MOD+Alt+L     { spawn-sh "swaylock"; }
    MOD+E         { spawn-sh "nautilus"; }

    // ─── Audio Controls ───
    XF86AudioRaiseVolume allow-when-locked=true { spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1+"; }
    XF86AudioLowerVolume allow-when-locked=true { spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1-"; }
    XF86AudioMute        allow-when-locked=true { spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle"; }
    XF86AudioMicMute     allow-when-locked=true { spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle"; }
    XF86AudioNext        allow-when-locked=true { spawn-sh "playerctl next"; }
    XF86AudioPause       allow-when-locked=true { spawn-sh "playerctl play-pause"; }
    XF86AudioPlay        allow-when-locked=true { spawn-sh "playerctl play-pause"; }
    XF86AudioPrev        allow-when-locked=true { spawn-sh "playerctl previous"; }

    // ─── Window Movement and Focus ───
    MOD+Q         { close-window; }

    MOD+Left      { focus-column-left; }
    MOD+H         { focus-column-left; }
    MOD+Right     { focus-column-right; }
    MOD+L         { focus-column-right; }
    MOD+Up        { focus-window-up; }
    MOD+K         { focus-window-up; }
    MOD+Down      { focus-window-down; }
    MOD+J         { focus-window-down; }

    MOD+Ctrl+Left     { move-column-left; }
    MOD+Ctrl+H        { move-column-left; }
    MOD+Ctrl+Right    { move-column-right; }
    MOD+Ctrl+L        { move-column-right; }
    MOD+Ctrl+Up       { move-window-up; }
    MOD+Ctrl+K        { move-window-up; }
    MOD+Ctrl+Down     { move-window-down; }
    MOD+Ctrl+J        { move-window-down; }

    MOD+Home          { focus-column-first; }
    MOD+End           { focus-column-last; }
    MOD+Ctrl+Home     { move-column-to-first; }
    MOD+Ctrl+End      { move-column-to-last; }

    MOD+Shift+Left    { focus-monitor-left; }
    MOD+Shift+Right   { focus-monitor-right; }
    MOD+Shift+Up      { focus-monitor-up; }
    MOD+Shift+Down    { focus-monitor-down; }

    MOD+Shift+Ctrl+Left     { move-column-to-monitor-left; }
    MOD+Shift+Ctrl+Right    { move-column-to-monitor-right; }
    MOD+Shift+Ctrl+Up       { move-column-to-monitor-up; }
    MOD+Shift+Ctrl+Down     { move-column-to-monitor-down; }

    // ─── Workspace Switching ───
    MOD+WheelScrollDown         cooldown-ms=150 { focus-workspace-down; }
    MOD+WheelScrollUp           cooldown-ms=150 { focus-workspace-up; }
    MOD+Ctrl+WheelScrollDown    cooldown-ms=150 { move-column-to-workspace-down; }
    MOD+Ctrl+WheelScrollUp      cooldown-ms=150 { move-column-to-workspace-up; }

    MOD+WheelScrollRight        { focus-column-right; }
    MOD+WheelScrollLeft         { focus-column-left; }
    MOD+Ctrl+WheelScrollRight   { move-column-right; }
    MOD+Ctrl+WheelScrollLeft    { move-column-left; }

    MOD+Shift+WheelScrollDown        { focus-column-right; }
    MOD+Shift+WheelScrollUp          { focus-column-left; }
    MOD+Ctrl+Shift+WheelScrollDown   { move-column-right; }
    MOD+Ctrl+Shift+WheelScrollUp     { move-column-left; }

    MOD+1         { focus-workspace 1; }
    MOD+2         { focus-workspace 2; }
    MOD+3         { focus-workspace 3; }
    MOD+4         { focus-workspace 4; }
    MOD+5         { focus-workspace 5; }
    MOD+6         { focus-workspace 6; }
    MOD+7         { focus-workspace 7; }
    MOD+8         { focus-workspace 8; }
    MOD+9         { focus-workspace 9; }

    MOD+Ctrl+1    { move-column-to-workspace 1; }
    MOD+Ctrl+2    { move-column-to-workspace 2; }
    MOD+Ctrl+3    { move-column-to-workspace 3; }
    MOD+Ctrl+4    { move-column-to-workspace 4; }
    MOD+Ctrl+5    { move-column-to-workspace 5; }
    MOD+Ctrl+6    { move-column-to-workspace 6; }
    MOD+Ctrl+7    { move-column-to-workspace 7; }
    MOD+Ctrl+8    { move-column-to-workspace 8; }
    MOD+Ctrl+9    { move-column-to-workspace 9; }

    MOD+Tab       { focus-workspace-previous; }

    // ─── Layout Controls ───
    MOD+Ctrl+F         { expand-column-to-available-width; }
    MOD+C              { center-column; }
    MOD+Ctrl+C         { center-visible-columns; }
    MOD+Minus          { set-column-width "-10%"; }
    MOD+Equal          { set-column-width "+10%"; }
    MOD+Shift+Minus    { set-window-height "-10%"; }
    MOD+Shift+Equal    { set-window-height "+10%"; }

    // ─── Modes ───
    MOD+T    { toggle-window-floating; }
    MOD+F    { fullscreen-window; }
    MOD+W    { toggle-column-tabbed-display; }

    // ─── Screenshots ───
    Print         { screenshot; }
    Ctrl+Print    { screenshot-screen write-to-disk=false; }
    Alt+Print     { screenshot-window write-to-disk=false; }

    // ─── Emergency Escape Key ───
    MOD+Escape    allow-inhibiting=false { toggle-keyboard-shortcuts-inhibit; }

    // ─── Exit / Power ───
    Ctrl+Alt+Delete    { quit; }
    MOD+Shift+P        { power-off-monitors; }
    MOD+O              repeat=false { toggle-overview; }
}

// ────────────── Startup Applications ──────────────
// https://github.com/YaLTeR/niri/wiki/Configuration:-Miscellaneous#spawn-sh-at-startup

spawn-sh-at-startup "/usr/lib/polkit-kde-authentication-agent-1 &"

prefer-no-csd           // Disable program decorations
screenshot-path null    // Disable screenshot saving

// ────────────── Layout Settings ──────────────
// https://github.com/YaLTeR/niri/wiki/Configuration:-Layout

layout {
    gaps 16
    center-focused-column "never"
    always-center-single-column

    preset-column-widths {
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
    }

    focus-ring {
        width 3
    }

    shadow {
        softness 30
        spread 5
        offset x=0 y=5
    }

    struts {}
}

// ────────────── Animation Settings ──────────────
// https://github.com/YaLTeR/niri/wiki/Configuration:-Animations

animations {
    workspace-switch {
        spring damping-ratio=1.0 stiffness=1000 epsilon=0.0001
    }
    window-open {
        duration-ms 200
        curve "ease-out-quad"
    }
    window-close {
        duration-ms 200
        curve "ease-out-cubic"
    }
    horizontal-view-movement {
        spring damping-ratio=1.0 stiffness=900 epsilon=0.0001
    }
    window-movement {
        spring damping-ratio=1.0 stiffness=800 epsilon=0.0001
    }
    window-resize {
        spring damping-ratio=1.0 stiffness=1000 epsilon=0.0001
    }
    config-notification-open-close {
        spring damping-ratio=0.6 stiffness=1200 epsilon=0.001
    }
    screenshot-ui-open {
        duration-ms 300
        curve "ease-out-quad"
    }
    overview-open-close {
        spring damping-ratio=1.0 stiffness=900 epsilon=0.0001
    }
}

// ────────────── Window Rules ──────────────
// https://github.com/YaLTeR/niri/wiki/Configuration:-Window-Rules

window-rule {
    match app-id=r#"firefox$"# title="^Picture-in-Picture$"
    open-floating true
}

window-rule {
    geometry-corner-radius 10
    clip-to-geometry true
}

// ────────────── Environment Variables ──────────────
// https://github.com/YaLTeR/niri/wiki/Configuration:-Miscellaneous#environment

environment {
    DISPLAY ":1"
    ELECTRON_OZONE_PLATFORM_HINT "auto"
    QT_QPA_PLATFORM "wayland"
    QT_WAYLAND_DISABLE_WINDOWDECORATION "1"
    XDG_SESSION_TYPE "wayland"
    XDG_CURRENT_DESKTOP "niri"
}

hotkey-overlay {
    skip-at-startup
}

cursor {
    xcursor-theme "macOS"
    xcursor-size 24
}

overview {
    backdrop-color "#191724"
}

// ────────────── Debug Options ──────────────
// https://yalter.github.io/niri/Configuration%3A-Debug-Options.html

debug {
    honor-xdg-activation-with-invalid-serial
}

include "./noctalia.kdl"
